!function(e,t,n){function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o,r=a(e),s=a(t),i=a(n),u={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,a,o,r,s,i,l="",d=0;for(e=u._utf8_encode(e);d<e.length;)o=(t=e.charCodeAt(d++))>>2,r=(3&t)<<4|(n=e.charCodeAt(d++))>>4,s=(15&n)<<2|(a=e.charCodeAt(d++))>>6,i=63&a,isNaN(n)?s=i=64:isNaN(a)&&(i=64),l=l+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(i);return l},decode:function(e){var t,n,a,o,r,s,i="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(o=this._keyStr.indexOf(e.charAt(l++)))>>4,n=(15&o)<<4|(r=this._keyStr.indexOf(e.charAt(l++)))>>2,a=(3&r)<<6|(s=this._keyStr.indexOf(e.charAt(l++))),i+=String.fromCharCode(t),64!=r&&(i+=String.fromCharCode(n)),64!=s&&(i+=String.fromCharCode(a));return i=u._utf8_decode(i)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){for(var t="",n=0,a=0,o=0,r=0;n<e.length;)(a=e.charCodeAt(n))<128?(t+=String.fromCharCode(a),n++):a>191&&a<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&a)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),r=e.charCodeAt(n+2),t+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&r),n+=3);return t}},l="id",d="Name",c="Value",p="SFName",m="SFValue",y="SFCombinedString",C="column1",f="column2",g="column3",S="column4",N="column5",h="column6",b="column7",v="column8",x="column9",w="column10",k="column11",R="column12",A="column13",F="column14",_="column15",V="column16",U="column17",I="column18",T="column19",j="column20",J="column21",H="column22",O="column23",P="column24",D="column25",L="column26",q="column27",E="column28",B="column29",z="column30",M="column31",X="column32",$="column33",G="column34",K="column35",Z="column36",W="column37",Q="column38",Y="column39",ee="column40",te="column41",ne="column42",ae="column43",oe="column44",re="column45",se="column46",ie="column47",ue="column48",le="column49",de="column50",ce="column51",pe="column52",me="column53",ye="column54",Ce="column55",fe="column56",ge="column57",Se="column58",Ne="column59",he="column60",be="column61",ve={displayName:"Read CSV as JSON",description:"CSV to JSON Object",properties:(o={csv:{displayName:"CSV File",type:"extendedString"}},i.default(o,l,{displayName:"ID",description:"ID",type:"number"}),i.default(o,d,{displayName:"Name",description:"Name",type:"extendedString"}),i.default(o,c,{displayName:"Value",description:"Value",type:"extendedString"}),i.default(o,p,{displayName:"SFName",description:"Name",type:"extendedString"}),i.default(o,m,{displayName:"SFValue",description:"Value",type:"extendedString"}),i.default(o,"SFParentID",{displayName:"SFParentID",description:"ParentID",type:"extendedString"}),i.default(o,y,{displayName:"SFCombinedString",description:"CombinedString",type:"extendedString"}),i.default(o,C,{displayName:"Column 1",description:"Column 1",type:"string"}),i.default(o,f,{displayName:"Column 2",description:"Column 2",type:"string"}),i.default(o,g,{displayName:"Column 3",description:"Column 3",type:"string"}),i.default(o,S,{displayName:"Column 4",description:"Column 4",type:"string"}),i.default(o,N,{displayName:"Column 5",description:"Column 5",type:"string"}),i.default(o,h,{displayName:"Column 6",description:"Column 6",type:"string"}),i.default(o,b,{displayName:"Column 7",description:"Column 7",type:"string"}),i.default(o,v,{displayName:"Column 8",description:"Column 8",type:"string"}),i.default(o,x,{displayName:"Column 9",description:"Column 9",type:"string"}),i.default(o,w,{displayName:"Column 10",description:"Column 10",type:"string"}),i.default(o,k,{displayName:"Column 11",description:"Column 11",type:"string"}),i.default(o,R,{displayName:"Column 12",description:"Column 12",type:"string"}),i.default(o,A,{displayName:"Column 13",description:"Column 13",type:"string"}),i.default(o,F,{displayName:"Column 14",description:"Column 14",type:"string"}),i.default(o,_,{displayName:"Column 15",description:"Column 15",type:"string"}),i.default(o,V,{displayName:"Column 16",description:"Column 16",type:"string"}),i.default(o,U,{displayName:"Column 17",description:"Column 17",type:"string"}),i.default(o,I,{displayName:"Column 18",description:"Column 18",type:"string"}),i.default(o,T,{displayName:"Column 19",description:"Column 19",type:"string"}),i.default(o,j,{displayName:"Column 20",description:"Column 20",type:"string"}),i.default(o,J,{displayName:"Column 21",description:"Column 21",type:"string"}),i.default(o,H,{displayName:"Column 22",description:"Column 22",type:"string"}),i.default(o,O,{displayName:"Column 23",description:"Column 23",type:"string"}),i.default(o,P,{displayName:"Column 24",description:"Column 24",type:"string"}),i.default(o,D,{displayName:"Column 25",description:"Column 25",type:"string"}),i.default(o,L,{displayName:"Column 26",description:"Column 26",type:"string"}),i.default(o,q,{displayName:"Column 27",description:"Column 27",type:"string"}),i.default(o,E,{displayName:"Column 28",description:"Column 28",type:"string"}),i.default(o,B,{displayName:"Column 29",description:"Column 29",type:"string"}),i.default(o,z,{displayName:"Column 30",description:"Column 30",type:"string"}),i.default(o,M,{displayName:"Column 31",description:"Column 31",type:"string"}),i.default(o,X,{displayName:"Column 32",description:"Column 32",type:"string"}),i.default(o,$,{displayName:"Column 33",description:"Column 33",type:"string"}),i.default(o,G,{displayName:"Column 34",description:"Column 34",type:"string"}),i.default(o,K,{displayName:"Column 35",description:"Column 35",type:"string"}),i.default(o,Z,{displayName:"Column 36",description:"Column 36",type:"string"}),i.default(o,W,{displayName:"Column 37",description:"Column 37",type:"string"}),i.default(o,Q,{displayName:"Column 38",description:"Column 38",type:"string"}),i.default(o,Y,{displayName:"Column 39",description:"Column 39",type:"string"}),i.default(o,ee,{displayName:"Column 40",description:"Column 40",type:"string"}),i.default(o,te,{displayName:"Column 41",description:"Column 41",type:"string"}),i.default(o,ne,{displayName:"Column 42",description:"Column 42",type:"string"}),i.default(o,ae,{displayName:"Column 43",description:"Column 43",type:"string"}),i.default(o,oe,{displayName:"Column 44",description:"Column 44",type:"string"}),i.default(o,re,{displayName:"Column 45",description:"Column 45",type:"string"}),i.default(o,se,{displayName:"Column 46",description:"Column 46",type:"string"}),i.default(o,ie,{displayName:"Column 47",description:"Column 47",type:"string"}),i.default(o,ue,{displayName:"Column 48",description:"Column 48",type:"string"}),i.default(o,le,{displayName:"Column 49",description:"Column 49",type:"string"}),i.default(o,de,{displayName:"Column 50",description:"Column 50",type:"string"}),i.default(o,ce,{displayName:"Column 51",description:"Column 51",type:"string"}),i.default(o,pe,{displayName:"Column 52",description:"Column 52",type:"string"}),i.default(o,me,{displayName:"Column 53",description:"Column 53",type:"string"}),i.default(o,ye,{displayName:"Column 54",description:"Column 54",type:"string"}),i.default(o,Ce,{displayName:"Column 55",description:"Column 55",type:"string"}),i.default(o,fe,{displayName:"Column 56",description:"Column 56",type:"string"}),i.default(o,ge,{displayName:"Column 57",description:"Column 57",type:"string"}),i.default(o,Se,{displayName:"Column 58",description:"Column 58",type:"string"}),i.default(o,Ne,{displayName:"Column 59",description:"Column 59",type:"string"}),i.default(o,he,{displayName:"Column 60",description:"Column 60",type:"string"}),i.default(o,be,{displayName:"Column 61",description:"Column 61",type:"string"}),i.default(o,"ColumnName",{displayName:"Column Index",description:"Column Index",type:"string"}),i.default(o,"output",{displayName:"Output",type:"extendedString"}),o),methods:{readCSV:{displayName:"Read CSV",type:"list",inputs:["csv"],outputs:[l,C,f,g,S,N,h,b,v,x,w,k,R,A,F,_,V,U,I,T,j,J,H,O,P,D,L,q,E,B,z,M,X,$,G,K,Z,W,Q,Y,ee,te,ne,ae,oe,re,se,ie,ue,le,de,ce,pe,me,ye,Ce,fe,ge,Se,Ne,he,be]},readCsvRow:{displayName:"Get a Row from CSV File",type:"read",inputs:["csv","id"],outputs:["id","column1","column2","column3","column4","column5","column6","column7","column8","column9","column10","column11","column12","column13","column14","column15","column16","column17","column18","column19","column20","column21","column22","column23","column24","column25","column26","column27","column28","column29","column30","column31","column32","column33","column34","column35","column36","column37","column38","column39","column40","column41","column42","column43","column44","column45","column46","column47","column48","column49","column50","column51","column52","column53","column54","column55","column56","column57","column58","column59","column60","column61"]},listHeaders:{displayName:"List Headers from CSV",type:"list",inputs:["csv","id"],outputs:[l,d,c]},readRowHeaders:{displayName:"Read Header row from CSV",type:"read",inputs:["csv","id"],outputs:[l,d,c]},combineString:{displayName:"Combine Strings for BULK API Upload",type:"read",inputs:["SFParentID","SFValue","SFName"],outputs:[y]}}};function xe(e,t,n,a){return we.apply(this,arguments)}function we(){return(we=s.default(r.default.mark((function e(t,n,a,o){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="readCSV"===e.t0?3:"readCsvRow"===e.t0?6:"listHeaders"===e.t0?9:"combineString"===e.t0?12:15;break;case 3:return e.next=5,Ae(n);case 5:return e.abrupt("break",16);case 6:return e.next=8,_e(a,n);case 8:return e.abrupt("break",16);case 9:return e.next=11,Fe(a,n);case 11:return e.abrupt("break",16);case 12:return e.next=14,Re(a,n);case 14:return e.abrupt("break",16);case 15:throw new Error("The method "+t+" is not supported.");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){return e.split("<content>")[1].split("</content>")[0]}function Re(e,t,n){return new Promise((function(e,n){console.log("executed");for(var a="",o=t.SFName.toString(),r=t.SFValue.toString(),s=o.split(","),i=r.split(","),u=0;u<s.length;u++)a+=t.SFParentID+","+s[u]+","+i[u]+"\n";postResult({SFCombinedString:a}),e()}))}function Ae(e,t){return new Promise((function(t,n){try{var a=u.decode(ke(e.csv.toString())).split("\n"),o=new RegExp('"',"g"),r=0,s=a.map((function(e){var t={};r+=1;var n=e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);t.id=r;for(var a=0;a<n.length;a++)a+1<61&&(t["column"+(a+1)]=n[a].replace(o,""));return t}));postResult(s),t()}catch(e){n(e)}}))}function Fe(e,t,n){return new Promise((function(e,n){try{var a,o=u.decode(ke(t.csv.toString())),r=new RegExp('"',"g"),s=+t.id,i=(a=o.split(/\r?\n/))[0],l=a[s-1],d={},c=l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);d=i.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map((function(e){var t={};return t.Name=e,t}));for(var p=0;p<c.length;p++)p+1<61&&(d[p].id=p+1,d[p].Value=c[p].replace(r,""));postResult(d),e()}catch(e){n(e)}}))}function _e(e,t,n){return new Promise((function(e,n){try{var a=u.decode(ke(t.csv.toString())),o=new RegExp('"',"g"),r=+t.id,s=a.split(/\r?\n/)[r-1],i={},l=s.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);i.id=r;for(var d=0;d<l.length;d++)d+1<61&&(i["column"+(d+1)]=l[d].replace(o,""));postResult(i),e()}catch(e){n(e)}}))}var Ve={displayName:"Salesforce Job Functions",description:"Salesforce Job Functions",properties:{jobId:{displayName:"Job Id",type:"string"},resultCode:{displayName:"Result Code",type:"string"},message:{displayName:"Message",type:"extendedString"},csvFile:{displayName:"CSV File",type:"attachment"},csvFileContent:{displayName:"File Content",type:"extendedString"},oldHeader:{displayName:"Old Header",type:"extendedString"},newHeader:{displayName:"New Header",type:"extendedString"},sobrId:{displayName:"SOBRID",type:"string"},csvString:{displayName:"CSV string",type:"extendedString"}},methods:{createJob:{displayName:"Create a New Job",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"},sfobject:{displayName:"SF Object",type:"string"},le:{displayName:"Line Ending",type:"string"}},inputs:[],outputs:["jobId","resultCode","message"]},updateJobState:{displayName:"Update Job State",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId"],outputs:["resultCode","message"]},uploadJobData:{displayName:"Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","csvFile"],outputs:["resultCode","message"]},convertAndUploadJobData:{displayName:"Convert and Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","oldHeader","newHeader","sobrId","csvFileContent"],outputs:["resultCode","message"]},createCSVAndUploadJobData:{displayName:"Create CSV and Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","csvString"],outputs:["resultCode","message"]}}};function Ue(e,t,n,a){return Ie.apply(this,arguments)}function Ie(){return(Ie=s.default(r.default.mark((function e(t,n,a,o){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="updateJobState"===e.t0?3:"uploadJobData"===e.t0?6:"convertAndUploadJobData"===e.t0?9:"createJob"===e.t0?12:"createCSVAndUploadJobData"===e.t0?15:18;break;case 3:return e.next=5,Te(a,n);case 5:return e.abrupt("break",19);case 6:return e.next=8,Je(a,n);case 8:return e.abrupt("break",19);case 9:return e.next=11,Oe(a,n);case 11:return e.abrupt("break",19);case 12:return e.next=14,je(a);case 14:return e.abrupt("break",19);case 15:return e.next=17,He(a,n);case 17:return e.abrupt("break",19);case 18:throw new Error("The method "+t+" is not supported.");case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t,n){return new Promise((function(n,a){try{var o=JSON.stringify({state:"UploadComplete"}),r=new XMLHttpRequest;return r.withCredentials=!0,r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)throw new Error("Failed with status ".concat(r.status.toString()," ").concat(r.statusText," and response ").concat(JSON.stringify(r.response)," "));postResult({resultCode:r.status,message:r.statusText})}},r.open("PATCH",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId),r.setRequestHeader("Authorization","Bearer "+e.token),r.setRequestHeader("Content-Type","application/json"),r.send(o)}catch(e){a(e)}}))}function je(e,t,n){return new Promise((function(t,n){try{console.log(e.sfobject);var a=JSON.stringify({object:e.sfobject,contentType:"CSV",operation:"insert",lineEnding:e.le}),o=new XMLHttpRequest;return o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status)throw new Error("Failed with status ".concat(o.status.toString()," ").concat(o.statusText," and response ").concat(JSON.stringify(o.response)," "));var e=JSON.parse(o.responseText);postResult({jobId:e.id,resultCode:o.status,message:o.statusText})}},o.open("POST",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest"),o.setRequestHeader("Authorization","Bearer "+e.token),o.setRequestHeader("Content-Type","application/json"),o.send(a)}catch(e){n(e)}}))}function Je(e,t,n){return new Promise((function(n,a){try{var o=new XMLHttpRequest;return o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState){if(201!==o.status)throw new Error("Failed with status ".concat(o.status.toString()," ").concat(o.statusText," and response ").concat(JSON.stringify(o.response)," "));postResult({resultCode:o.status,message:o.statusText})}},o.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),o.setRequestHeader("Authorization","Bearer "+e.token),o.setRequestHeader("Content-Type","text/csv"),o.send(t.csvFile)}catch(e){a(e)}}))}function He(e,t,n){return new Promise((function(n,a){try{var o=new XMLHttpRequest,r=t.csvString.toString();return r=r.replace(new RegExp(/\$LB\//gm),"\n"),o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState){if(201!==o.status)throw new Error("Failed with status ".concat(o.status.toString()," ").concat(o.statusText," and response ").concat(JSON.stringify(o.response)," "));postResult({resultCode:o.status,message:o.statusText})}},o.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),o.setRequestHeader("Authorization","Bearer "+e.token),o.setRequestHeader("Content-Type","text/csv"),console.log("Posted CSV: "+r),o.send(r)}catch(e){a(e)}}))}function Oe(e,t,n){return new Promise((function(n,a){try{var o=Le.decode(t.csvFileContent.toString().split("<content>")[1].split("</content>")[0]),r=t.oldHeader.toString(),s=t.newHeader.toString(),i=t.sobrId.toString(),u=o.replace(r,"");u=s+(u=u.replace(new RegExp("\n","g"),"\n"+i+","));var l=new XMLHttpRequest;return l.withCredentials=!0,l.onreadystatechange=function(){if(4===l.readyState){if(201!==l.status)throw new Error("Failed with status ".concat(l.status.toString()," ").concat(l.statusText," and response ").concat(JSON.stringify(l.response)," "));postResult({resultCode:l.status,message:l.statusText})}},l.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),l.setRequestHeader("Authorization","Bearer "+e.token),l.setRequestHeader("Content-Type","text/csv"),l.send(u)}catch(e){a(e)}}))}var Pe,De,Le={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,a,o,r,s,i,u="",l=0;for(e=Le._utf8_encode(e);l<e.length;)o=(t=e.charCodeAt(l++))>>2,r=(3&t)<<4|(n=e.charCodeAt(l++))>>4,s=(15&n)<<2|(a=e.charCodeAt(l++))>>6,i=63&a,isNaN(n)?s=i=64:isNaN(a)&&(i=64),u=u+this._keyStr.charAt(o)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(i);return u},decode:function(e){var t,n,a,o,r,s,i="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)t=this._keyStr.indexOf(e.charAt(u++))<<2|(o=this._keyStr.indexOf(e.charAt(u++)))>>4,n=(15&o)<<4|(r=this._keyStr.indexOf(e.charAt(u++)))>>2,a=(3&r)<<6|(s=this._keyStr.indexOf(e.charAt(u++))),i+=String.fromCharCode(t),64!=r&&(i+=String.fromCharCode(n)),64!=s&&(i+=String.fromCharCode(a));return i=Le._utf8_decode(i)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var a=e.charCodeAt(n);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){for(var t="",n=0,a=0,o=0,r=0;n<e.length;)(a=e.charCodeAt(n))<128?(t+=String.fromCharCode(a),n++):a>191&&a<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&a)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),r=e.charCodeAt(n+2),t+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&r),n+=3);return t}};metadata={systemName:"ReadCSVasJSON",displayName:"Read CSV as JSON",description:"A Utility broker using CSV in K2 Workflows",configuration:{ServiceURL:{displayName:"Service URL",type:"string",value:"https://www.cloudfunctions.net"}}},ondescribe=(Pe=s.default(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.configuration,postSchema({objects:{csvFunctions:ve,jobFunctions:Ve}});case 2:case"end":return e.stop()}}),e)}))),function(e){return Pe.apply(this,arguments)}),onexecute=(De=s.default(r.default.mark((function e(t){var n,a,o,s,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.objectName,a=t.methodName,o=t.parameters,s=t.properties,i=t.configuration,e.t0=n,e.next="csvFunctions"===e.t0?4:"jobFunctions"===e.t0?7:10;break;case 4:return e.next=6,xe(a,s,o,i);case 6:return e.abrupt("break",11);case 7:return e.next=9,Ue(a,s,o,i);case 9:return e.abrupt("break",11);case 10:throw new Error("The object "+n+" is not supported.");case 11:case"end":return e.stop()}}),e)}))),function(e){return De.apply(this,arguments)})}(_regeneratorRuntime,_asyncToGenerator,_defineProperty);
//# sourceMappingURL=CSVUtilities.jssp.map
