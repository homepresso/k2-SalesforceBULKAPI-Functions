!function(e,t){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),a=n(t),s={displayName:"Salesforce Job Functions",description:"Salesforce Job Functions",properties:{jobId:{displayName:"Job Id",type:"string"},resultCode:{displayName:"Result Code",type:"string"},message:{displayName:"Message",type:"extendedString"},csvFile:{displayName:"CSV File",type:"attachment"},csvFileContent:{displayName:"File Content",type:"extendedString"},oldHeader:{displayName:"Old Header",type:"extendedString"},newHeader:{displayName:"New Header",type:"extendedString"},sobrId:{displayName:"SOBRID",type:"string"},csvString:{displayName:"CSV string",type:"extendedString"}},methods:{createJob:{displayName:"Create a New Job",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"},sfobject:{displayName:"SF Object",type:"string"},le:{displayName:"Line Ending",type:"string"}},inputs:[],outputs:["jobId","resultCode","message"]},updateJobState:{displayName:"Update Job State",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId"],outputs:["resultCode","message"]},uploadJobData:{displayName:"Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","csvFile"],outputs:["resultCode","message"]},convertAndUploadJobData:{displayName:"Convert and Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","oldHeader","newHeader","sobrId","csvFileContent"],outputs:["resultCode","message"]},createCSVAndUploadJobData:{displayName:"Create CSV and Upload Job Data",type:"execute",parameters:{instanceUrl:{displayName:"Instance URL",type:"extendedString"},version:{displayName:"Version",type:"string"},token:{displayName:"Token",type:"string"}},inputs:["jobId","csvString"],outputs:["resultCode","message"]}}};function o(e,t,n,r){return i.apply(this,arguments)}function i(){return(i=a.default(r.default.mark((function e(t,n,a,s){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="updateJobState"===e.t0?3:"uploadJobData"===e.t0?6:"convertAndUploadJobData"===e.t0?9:"createJob"===e.t0?12:"createCSVAndUploadJobData"===e.t0?15:18;break;case 3:return e.next=5,d(a,n);case 5:return e.abrupt("break",19);case 6:return e.next=8,u(a,n);case 8:return e.abrupt("break",19);case 9:return e.next=11,l(a,n);case 11:return e.abrupt("break",19);case 12:return e.next=14,c(a);case 14:return e.abrupt("break",19);case 15:return e.next=17,p(a,n);case 17:return e.abrupt("break",19);case 18:throw new Error("The method "+t+" is not supported.");case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e,t,n){return new Promise((function(n,r){try{var a=JSON.stringify({state:"UploadComplete"}),s=new XMLHttpRequest;return s.withCredentials=!0,s.onreadystatechange=function(){if(4===s.readyState){if(200!==s.status)throw new Error("Failed with status ".concat(s.status.toString()," ").concat(s.statusText," and response ").concat(JSON.stringify(s.response)," "));postResult({resultCode:s.status,message:s.statusText})}},s.open("PATCH",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId),s.setRequestHeader("Authorization","Bearer "+e.token),s.setRequestHeader("Content-Type","application/json"),s.send(a)}catch(e){r(e)}}))}function c(e,t,n){return new Promise((function(t,n){try{console.log(e.sfobject);var r=JSON.stringify({object:e.sfobject,contentType:"CSV",operation:"insert",lineEnding:e.le}),a=new XMLHttpRequest;return a.withCredentials=!0,a.onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)throw new Error("Failed with status ".concat(a.status.toString()," ").concat(a.statusText," and response ").concat(JSON.stringify(a.response)," "));var e=JSON.parse(a.responseText);postResult({jobId:e.id,resultCode:a.status,message:a.statusText})}},a.open("POST",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest"),a.setRequestHeader("Authorization","Bearer "+e.token),a.setRequestHeader("Content-Type","application/json"),a.send(r)}catch(e){n(e)}}))}function u(e,t,n){return new Promise((function(n,r){try{var a=new XMLHttpRequest;return a.withCredentials=!0,a.onreadystatechange=function(){if(4===a.readyState){if(201!==a.status)throw new Error("Failed with status ".concat(a.status.toString()," ").concat(a.statusText," and response ").concat(JSON.stringify(a.response)," "));postResult({resultCode:a.status,message:a.statusText})}},a.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),a.setRequestHeader("Authorization","Bearer "+e.token),a.setRequestHeader("Content-Type","text/csv"),a.send(t.csvFile)}catch(e){r(e)}}))}function p(e,t,n){return new Promise((function(n,r){try{var a=new XMLHttpRequest,s=t.csvString.toString();return s=s.replace(new RegExp(/\$LB\//gm),"\n"),a.withCredentials=!0,a.onreadystatechange=function(){if(4===a.readyState){if(201!==a.status)throw new Error("Failed with status ".concat(a.status.toString()," ").concat(a.statusText," and response ").concat(JSON.stringify(a.response)," "));postResult({resultCode:a.status,message:a.statusText})}},a.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),a.setRequestHeader("Authorization","Bearer "+e.token),a.setRequestHeader("Content-Type","text/csv"),console.log("Posted CSV: "+s),a.send(s)}catch(e){r(e)}}))}function l(e,t,n){return new Promise((function(n,r){try{var a=f.decode(t.csvFileContent.toString().split("<content>")[1].split("</content>")[0]),s=t.oldHeader.toString(),o=t.newHeader.toString(),i=t.sobrId.toString(),d=a.replace(s,"");d=o+(d=d.replace(new RegExp("\n","g"),"\n"+i+","));var c=new XMLHttpRequest;return c.withCredentials=!0,c.onreadystatechange=function(){if(4===c.readyState){if(201!==c.status)throw new Error("Failed with status ".concat(c.status.toString()," ").concat(c.statusText," and response ").concat(JSON.stringify(c.response)," "));postResult({resultCode:c.status,message:c.statusText})}},c.open("PUT",e.instanceUrl+"/services/data/"+e.version+"/jobs/ingest/"+t.jobId+"/batches"),c.setRequestHeader("Authorization","Bearer "+e.token),c.setRequestHeader("Content-Type","text/csv"),c.send(d)}catch(e){r(e)}}))}var y,g,f={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,a,s,o,i,d="",c=0;for(e=f._utf8_encode(e);c<e.length;)a=(t=e.charCodeAt(c++))>>2,s=(3&t)<<4|(n=e.charCodeAt(c++))>>4,o=(15&n)<<2|(r=e.charCodeAt(c++))>>6,i=63&r,isNaN(n)?o=i=64:isNaN(r)&&(i=64),d=d+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(i);return d},decode:function(e){var t,n,r,a,s,o,i="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)t=this._keyStr.indexOf(e.charAt(d++))<<2|(a=this._keyStr.indexOf(e.charAt(d++)))>>4,n=(15&a)<<4|(s=this._keyStr.indexOf(e.charAt(d++)))>>2,r=(3&s)<<6|(o=this._keyStr.indexOf(e.charAt(d++))),i+=String.fromCharCode(t),64!=s&&(i+=String.fromCharCode(n)),64!=o&&(i+=String.fromCharCode(r));return i=f._utf8_decode(i)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",n=0,r=0,a=0,s=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(a=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&a),n+=2):(a=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&s),n+=3);return t}};metadata={systemName:"SFBulkAPIjobs",displayName:"Salesforce Bulk API Functions",description:"A Utility broker to upload content to the Salesforce BULK API",configuration:{ServiceURL:{displayName:"Service URL",type:"string",value:"https://www.cloudfunctions.net"}}},ondescribe=(y=a.default(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.configuration,postSchema({objects:{jobFunctions:s}});case 2:case"end":return e.stop()}}),e)}))),function(e){return y.apply(this,arguments)}),onexecute=(g=a.default(r.default.mark((function e(t){var n,a,s,i,d;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.objectName,a=t.methodName,s=t.parameters,i=t.properties,d=t.configuration,e.t0=n,e.next="jobFunctions"===e.t0?4:7;break;case 4:return e.next=6,o(a,i,s,d);case 6:return e.abrupt("break",8);case 7:throw new Error("The object "+n+" is not supported.");case 8:case"end":return e.stop()}}),e)}))),function(e){return g.apply(this,arguments)})}(_regeneratorRuntime,_asyncToGenerator);
//# sourceMappingURL=SFBulkAPIJobs.jssp.map
